import * as vscode from 'vscode';
import * as MarkdownIt from 'markdown-it';
import markdownItRegex from 'markdown-it-regex';

const icon = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 999.67 813.96" width="1em">' +
                '<defs><style>.cls-1{opacity:0.5;}.cls-2{fill:#3ea84b;}.cls-3{fill:#6f4549;}</style></defs>' +
                '<g class="cls-1">' +
                    '<path class="cls-2" d="M0,369.33c1.25-10.05,2.26-20.14,3.79-30.15,7.76-50.81,27.42-96.81,56.79-138.75C101.3,142.31,154.69,98.74,216.94,65.65c56.36-30,116.41-48.83,179.46-58.49A610.62,610.62,0,0,1,543.91,2.43c104.33,9.36,200.35,41.77,284.8,105,51.62,38.64,93.07,86.08,120.78,144.74,24.58,52,34.76,106.84,29.15,164.19-6.79,69.48-34.89,130-79.42,183.17-46.35,55.33-104,95.46-169.64,124.62C675.17,748.3,618.2,763.05,559,769.53c-87.49,9.6-173.19,1.44-257-25.64-6.48-2.09-13.07-4-19.27-6.83-9.62-4.31-19.33-4.36-29.33-2.23-24.38,5.19-47.29,14.7-70.2,24.16C152,771.88,120.9,785,89.59,797.62c-6.23,2.51-13.1,3.76-19.8,4.71-5.88.84-8.67-1.61-8.53-7.58.15-6.6.62-13.44,2.5-19.71,7.92-26.44,16.73-52.62,24.6-79.08,4.93-16.55,9-33.39,13-50.19,1.06-4.46.73-9.27.86-13.92.17-6.15-2.27-11.09-6.52-15.63-34.44-36.79-61.16-78.39-77.92-126.13A306.54,306.54,0,0,1,.85,408.7,35.1,35.1,0,0,0,0,404.33ZM130,728.45c4.73-2,9-3.86,13.2-5.65C173,710.27,202.49,697.19,233.86,689c22.8-5.93,45-6.21,67.55,2.56,44,17.1,90,26.4,137,30.58a572.59,572.59,0,0,0,134.1-3.71c67.12-9.85,130.42-30.74,188.77-65.67,52.84-31.64,97.78-71.85,129.4-125.24,46.77-79,53.88-161.51,18.05-246.54-22.88-54.29-60.39-97.43-106.94-132.78C725.05,90,637.39,60.48,542.29,51.45a561.4,561.4,0,0,0-135.58,3.69C343.16,64.52,283,83.92,227.11,115.8,173.2,146.56,126.83,186,93.68,239,40.86,323.51,33.86,411.67,76,502.72c14,30.36,33.63,57,56.6,81.25,9.58,10.1,15.7,21.79,17.78,35.58,2.89,19.18-.14,37.9-5,56.32C140.69,693.21,135.32,710.35,130,728.45Z"/>' +
                    '<path class="cls-2" d="M372.28,391.84a48.91,48.91,0,0,1-48.69,49.22c-26.88.17-49-21.77-49.2-48.83a48.95,48.95,0,0,1,97.89-.39Z"/>' +
                    '<path class="cls-2" d="M673.74,343.17a48.95,48.95,0,1,1-49.17,48.63A48.67,48.67,0,0,1,673.74,343.17Z"/>' +
                    '<path class="cls-2" d="M547.28,392.06a48.95,48.95,0,1,1-48.86-48.9A48.89,48.89,0,0,1,547.28,392.06Z"/>' +
                    '<path class="cls-3" d="M19.52,380.8c1.25-10.06,2.26-20.15,3.79-30.16,7.76-50.8,27.42-96.81,56.79-138.74,40.72-58.12,94.11-101.69,156.36-134.79,56.37-30,116.41-48.83,179.46-58.48a610.62,610.62,0,0,1,147.51-4.74c104.33,9.37,200.35,41.78,284.8,105C899.85,157.5,941.3,204.94,969,263.6c24.58,52,34.76,106.84,29.15,164.2-6.79,69.48-34.89,130-79.42,183.16-46.35,55.34-104,95.47-169.64,124.62C694.69,759.76,637.72,774.51,578.56,781c-87.49,9.59-173.19,1.44-257-25.64-6.48-2.1-13.07-4.06-19.27-6.84-9.62-4.31-19.33-4.36-29.33-2.23-24.38,5.2-47.29,14.71-70.2,24.17-31.21,12.89-62.33,26-93.64,38.62-6.23,2.52-13.1,3.77-19.8,4.72-5.88.83-8.67-1.62-8.53-7.59.15-6.59.62-13.43,2.5-19.7,7.92-26.45,16.73-52.63,24.6-79.08,4.93-16.56,9-33.39,13-50.2,1.06-4.45.73-9.26.86-13.92.17-6.15-2.27-11.08-6.52-15.62C80.75,590.9,54,549.29,37.27,501.55a306.47,306.47,0,0,1-16.9-81.38,34.75,34.75,0,0,0-.85-4.37Zm130,359.12c4.73-2,9-3.87,13.2-5.66,29.74-12.53,59.27-25.6,90.64-33.76,22.8-5.93,45-6.22,67.55,2.56,44,17.09,90,26.39,137,30.57A571.51,571.51,0,0,0,592,729.92c67.12-9.85,130.42-30.73,188.77-65.67,52.84-31.64,97.78-71.84,129.4-125.23C957,460,964.06,377.5,928.23,292.48,905.35,238.19,867.84,195,821.29,159.69c-76.72-58.25-164.38-87.75-259.48-96.78A561.4,561.4,0,0,0,426.23,66.6C362.68,76,302.51,95.38,246.63,127.27,192.72,158,146.35,197.41,113.2,250.45,60.38,335,53.38,423.13,95.47,514.19c14,30.35,33.63,57,56.6,81.24,9.58,10.1,15.7,21.79,17.78,35.59,2.89,19.18-.14,37.89-5,56.32C160.21,704.68,154.84,721.81,149.54,739.92Z"/>' +
                    '<path class="cls-3" d="M391.8,403.31a48.91,48.91,0,0,1-48.69,49.22c-26.88.16-49-21.78-49.2-48.83a48.95,48.95,0,0,1,97.89-.39Z"/>' +
                    '<path class="cls-3" d="M693.26,354.63a49,49,0,1,1-49.17,48.63A48.68,48.68,0,0,1,693.26,354.63Z"/>' +
                    '<path class="cls-3" d="M566.8,403.53a48.95,48.95,0,1,1-48.86-48.9A48.9,48.9,0,0,1,566.8,403.53Z"/>' +
                '</g>' +
             '</svg>';

const extendMarkdownIt = (md: MarkdownIt) => {
    const file = !!vscode.window.activeTextEditor ? vscode.window.activeTextEditor.document.fileName : '';

    const mdExtended = md
        .use(markdownItRegex, {
            name: 'html_block',
            regex: /<!--([\w\W\r\n]+)-->/,
            replace: (rawRef: string) => {
                if (/<!--([\w\W\r\n]+)-->/.test(rawRef)) {
                    const fileContentLines = rawRef.split(/\r?\n/g);
                    const commandSVG =
                        '<label title="' +
                        fileContentLines.join('&#10;') +
                        '">' + icon + '</label>'
                        ;
                    return commandSVG;
                }
                return rawRef;
            },
        });

    return mdExtended;
};

export default extendMarkdownIt;
